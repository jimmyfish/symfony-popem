// BINDING REGISTER FUNCTION
function registerAction(e) {
    e.preventDefault();
    var wrapper = jQuery('.content-main'),
        container = wrapper.find('form'),
        sendInfo = {
            "username": container.find('#username').val(),
            "email": container.find('#email').val(),
            "password": container.find('#password').val(),
            "passconf": container.find('#password-confirm').val()
        },
        sourcePath = "{{ path('popem_api_client_register') }}";

    $.ajax({
        type: 'POST',
        url: sourcePath,
        data: sendInfo,
        beforeSend: function () {
            container.find('button').val('Memproses ...');
            container.find('input, button').prop('disabled', true);
            container.find('.spinner').removeClass('hide');
        },
        success: function (msg) {
            if (msg.status === true) {
                wrapper.find('.success-notification').removeClass('hide');
                wrapper.find('form').hide();
            }else{
                wrapper.find('.error-notification').removeClass('hide');
                wrapper.find('.error-notification').find('.error-notif').text(msg.data.message);
                {#container.reset();#}
                {#wrapper.find('form').hide();#}
            }
        },
        complete: function() {
            container.find('input, button').prop('disabled',false);
            container.find('.spinner').addClass('hide');
        }
    });
}

// BINDING DEPOSIT TO ACCOUNT FUNCTION
function depositAction(e) {
    e.preventDefault();
    var wrapper = $('.content-main'),
        container = wrapper.find('form'),
        sourcePath = "{{ path('popem_api_client_deposit_account') }}",
        formData = new FormData();

    formData.append("broker_id", parseInt(container.find('#deposit__broker').val()));
    formData.append("login", parseInt(container.find('#login').val()));
    formData.append("email", container.find('#deposit_email').val());
    formData.append("phone", container.find('#phone').val());
    formData.append("bank_name", container.find('#bank_name').val());
    formData.append("bank_account", parseInt(container.find('#bank_account').val()));
    formData.append("bank_beneficiary_name", container.find('#bank_beneficiary_name').val());
    formData.append("bank_id", parseInt(container.find('#bank_id').val()));
    formData.append("amount", parseInt(container.find('#amount').val()));
    formData.append("file", container.find('#file')[0].files[0]);

    $.ajax({
        type: 'POST',
        url: sourcePath,
        data: formData,
        contentType: false,
        processData: false,
        cache: false,
        dataType: 'json',
        beforeSend: function () {
            wrapper.find('input').prop('disabled', true);
            wrapper.find('button').prop('disabled', true);
            wrapper.find('.caption').text('Memproses');
            wrapper.find('.spinner').removeClass('hide');
        },
        success: function (data) {
            if (data.data.status == true) {
                var sucWrapper = wrapper.find('.success-notification'),
                    balance = parseInt(data.data.amount_transfer).toLocaleString();
                sucWrapper.find('.dept_amount').text(balance);
                sucWrapper.find('.ticket').text(data.data.ticket_number);
                container.hide();
                sucWrapper.removeClass('hide');
            }else {
                wrapper.find('.error-notification').removeClass('hide');
                wrapper.find('.error-notification').find('.error-notif-deposit').text(data.data.message);
                container.hide();
            }
        },
        error: function (e) {
            console.log(e);
        }
    });
}

function withdrawalAccount(e) {
    e.preventDefault();

    var wrapper = jQuery('.content-main'),
        container = wrapper.find('form'),
        sourcePath = "{{ path('popem_api_client_withdrawal_account') }}",
        sendInfo = {
            'broker_id': parseInt(container.find('#withdrawal_broker_id').val()),
            'login': parseInt(container.find('#withdrawal_login').val()),
            'phone_password': container.find('#withdrawal_phone_password').val(),
            'email': container.find('#withdrawal_email').val(),
            'phone': container.find('#withdrawal_phone').val(),
            'bank_name': container.find('#withdrawal_bank_name').val(),
            'bank_account': container.find('#withdrawal_bank_account').val(),
            'bank_beneficiary_name': container.find('#withdrawal_bank_beneficiary_name').val(),
            'amount': parseInt(container.find('#withdrawal_amount').val()),
        };


    $.ajax({
        type: 'POST',
        url: sourcePath,
        data: sendInfo,
        beforeSend: function () {
            wrapper.find('input').prop('disabled', true);
            wrapper.find('button').prop('disabled', true);
            wrapper.find('.caption').text('Memproses');
            wrapper.find('.spinner').removeClass('hide');
        },
        success: function (data) {
            if (data.data.status == true) {
                var sucWrapper = wrapper.find('.success-notification');
                sucWrapper.find('.ticket').text(data.data.ticket_number);
                container.hide();
                sucWrapper.removeClass('hide');
            } else {
                wrapper.find('.error-notification').removeClass('hide');
                wrapper.find('.error-notification').find('.error-notif-withdrawal').text(data.data.message);
                container.hide();
            }
        },
        error: function (err) {
            console.log(err);
        }
    });
}